name: Main

on:
  push:
    tags:
      - "v*.*.*"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Build
        run: |
          sed -i "s/API_KEY = os.getenv('API_KEY') or ''/API_KEY = '${{secrets.API_KEY}}'/g" auth.py
          sed -i "s/CLIENT_SECRET = os.getenv('CLIENT_SECRET') or ''/CLIENT_SECRET = '${{secrets.CLIENT_SECRET}}'/g" auth.py
      - name: Package
        run: |
          md -p artifact/mom_colonisation_tracker
          copy *.py artifact/mom_colonisation_tracker/
          zip release.zip ./artifact/* -r
      - name: Release
        uses: softprops/action-gh-release@v2
        with:
          files: release.zip
          body_path: CHANGELOG.md
